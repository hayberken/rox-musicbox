#!/usr/bin/env python
import findrox; findrox.version(1, 9, 8)
import sys, os, gobject, socket
import rox

__builtins__._ = rox.i18n.translation(os.path.join(rox.app_dir, 'Messages'))

from rox import g
import gtkexcepthook
import musicbox


if g.pygtk_version < (1,99,17):
	rox.croak('Need pygtk 1.99.17 or later:\n'
		'http://www.daa.com.au/~james/software/pygtk/')

try:
	g.threads_init()
except RuntimeError:
	rox.croak('You must have threads compiled into your PyGTK!')


#see if another instance is running and pass it our args (via xmlrpc)
try:
	import xmlrpclib
	client = xmlrpclib.Server("http://localhost:8989", None, False)
	client.load_args(sys.argv[1:])

#if not then start a new instance
except socket.error:
	box = musicbox.MusicBox()
	box.show()

	g.threads_enter()
	rox.mainloop()
	g.threads_leave()

#other errors here.
except:
	rox.croak('Unknown error starting MusicBox')


